---
title: "p8105_hw2_yl5829"
output: html_document
date: "2024-10-01"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(readxl)
```

## R Markdown

#Problem 1

```{r}
#load the data in relative path
nyc <- read_csv("data/NYC_Transit_Subway_Entrance_And_Exit_Data.csv", na = c(".", "NA", ""))
head(nyc)
```


```{r}
#clean the data
nyc_clean <- nyc %>%
  janitor::clean_names() %>%
  select(line, station_name, station_latitude, station_longitude, 
         route1, route2, route3, route4, route5, route6, route7, route8, route9, route10, route11, 
         entry, vending, entrance_type, ada) %>%
  mutate(entry = ifelse(entry == "YES", TRUE, FALSE))

#look at the cleaned data
head(nyc_clean)
```

```{r}
#check for column names
colnames(nyc)
#check for number of column
ncol(nyc)
#check for dimension of cleaned data
dim(nyc_clean)
```

The dataset contains 32 variables and it mainly focuses on the subway entrances and exits in the NYC transit system. The variables included are line name, station name, geographic information (latitude and longitude), various routes served by the station (up to 11 routes), entry type, vending machine availability, some street, entrance type and geographic information (latitude, longitude, and location), and ADA compliance. After loading the data I use janitor::clean_names() function to convert all the variable to lower case and replaced spaces with underscores  to better performe next step. I next select relevant variables and transformed the entry column, which initially contained "YES" and "NO" values, into a logical variable (TRUE for "YES" and FALSE for "NO"). I also handled the missing values by specify any missing value to be NA in the data.
After clean there are 1868 rows and 19 columns in total. The data is tidy as each variable is stored in its own column, each observation is in its own row, and the dataset is organized for further analysis.

```{r}
#the number of distinct stations
distinct_stations <- nyc_clean %>%
  distinct(station_name, line) %>%
  nrow()

#see the output
distinct_stations
```
There are 465 distinct stations.

```{r}
#the number of ADA compliant stations
ada_compliant <- nyc_clean %>%
  filter(ada == "TRUE") %>%
  distinct(station_name, line) %>%
  nrow()

#see the output
ada_compliant
```
There are 84 ADA compliant.

```{r}
#proportion of station entrances / exits without vending allow entrance
proportion <- nyc_clean %>%
  filter(vending == "NO" & entry == TRUE) %>%
  nrow() / nrow(nyc_clean)

# Output the proportion
proportion
```
There is 0.0369 station entrances / exits without vending allow entrance

```{r}
#convert all route columns to character type
nyc_clean <- nyc_clean %>%
  mutate(across(starts_with("route"), as.character))

#reshape the data
nyc_routes <- nyc_clean %>%
  pivot_longer(cols = starts_with("route"), names_to = "route_number", values_to = "route_name") %>%
  filter(!is.na(route_name))

#look at the reshaped data
head(nyc_routes)
```

```{r}
#count distinct stations that serve the A train
a_train <- nyc_routes %>%
  filter(route_name == "A") %>%
  distinct(station_name, line) %>%
  nrow()

#number of distinct stations that serve the A train
a_train

#count ADA compliant stations that serve the A train
a_ada <- nyc_routes %>%
  filter(route_name == "A", ada == TRUE) %>%
  distinct(station_name, line) %>%
  nrow()

#number of ADA compliant stations that serve the A train
a_ada
```
There are 60 distinct stations serve the A train and of them 17 are ADA compliant

#Problem 2

```{r}
#load the mr trash wheel data in relative path
mr_wheel <- read_excel("data/202409 Trash Wheel Collection Data.xlsx", sheet = "Mr. Trash Wheel", na = c(".", "NA", ""))
head(mr_wheel)
```

```{r}
mr_wheel_clean <- mr_wheel %>%
  #make more reasonable names
  rename(
    dumpster = `Dumpster`,
    month = `Month`,  
    year = `Year`,    
    date = `Date`,
    weight_tons = `Weight (tons)`,
    volume_cubic_yards = `Volume (cubic yards)`,
    plastic_bottles = `Plastic Bottles`,
    polystyrene = `Polystyrene`,
    cigarette_butts = `Cigarette Butts`,
    glass_bottles = `Glass Bottles`,
    sports_balls = `Sports Balls`,
    homes_powered = `Homes Powered*`
  ) %>%
  mutate(year = as.character(year))%>%
  #remove rows that don't contain dumpster-specific data
  filter(!is.na(dumpster)) %>%
  #round the number of sports balls to the nearest integer and convert to integer
  mutate(sports_balls = as.integer(round(sports_balls, 0)))

#look at the cleaned data
head(mr_wheel_clean)
```

```{r}
#professor Trash Wheel data
prof_wheel <- read_excel("data/202409 Trash Wheel Collection Data.xlsx", sheet = "Professor Trash Wheel")

head(prof_wheel)
```

```{r}
#clean Professor Trash Wheel data
prof_wheel_clean <- prof_wheel %>%
  rename(
    dumpster = `Dumpster`,
    month = `Month`,
    year = `Year`,
    date = `Date`,
    weight_tons = `Weight (tons)`,
    volume_cubic_yards = `Volume (cubic yards)`,
    plastic_bottles = `Plastic Bottles`,
    polystyrene = `Polystyrene`,
    cigarette_butts = `Cigarette Butts`,
    glass_bottles = `Glass Bottles`,
    plastic_bags = `Plastic Bags`,
    wrappers = `Wrappers`,
    homes_powered = `Homes Powered*`
  ) %>%
  mutate(year = as.character(year)) %>%
  filter(!is.na(dumpster))

head(prof_wheel_clean)
```
```{r}
#add a new column to identify the data source
prof_wheel_clean <- prof_wheel_clean %>%
  mutate(source = "Professor Trash Wheel")
prof_wheel_clean
```

```{r}
#Gwynnda Trash Wheel data
gwynnda_wheel <- read_excel("data/202409 Trash Wheel Collection Data.xlsx", sheet = "Gwynnda Trash Wheel")
head(gwynnda_wheel)
```

```{r}
#clean Gwynnda Trash Wheel data
gwynnda_wheel_clean <- gwynnda_wheel %>%
    rename(
    dumpster = `Dumpster`,
    month = `Month`,
    year = `Year`,
    date = `Date`,
    weight_tons = `Weight (tons)`,
    volume_cubic_yards = `Volume (cubic yards)`,
    plastic_bottles = `Plastic Bottles`,
    polystyrene = `Polystyrene`,
    cigarette_butts = `Cigarette Butts`,
    plastic_bags = `Plastic Bags`,
    wrappers = `Wrappers`,
    homes_powered = `Homes Powered*`
  ) %>%
  mutate(year = as.character(year))%>%
  #remove rows that don't contain dumpster-specific data
  filter(!is.na(dumpster))

#loot at the cleaned data
head(gwynnda_wheel_clean)
```
```{r}
#add a new column to identify the data source (Gwynnda Trash Wheel)
gwynnda_wheel_clean <- gwynnda_wheel_clean %>% mutate(source = "Gwynnda Trash Wheel")
head(gwynnda_wheel_clean)
```

```{r}
#add a new column to identify the data source (Mr. Trash Wheel)
mr_wheel_clean <- mr_wheel_clean %>%
  mutate(source = "Mr. Trash Wheel")
head(mr_wheel_clean)
```

```{r}
#combine all datasets into one tidy dataset
combined_wheel <- bind_rows(mr_wheel_clean, prof_wheel_clean, gwynnda_wheel_clean) %>% 
  janitor::clean_names()

#look at the combined dataset
head(combined_wheel)
```

The dataset combines data from three datasets: Mr. Trash Wheel, Professor Trash Wheel, and Gwynnda Trash Wheel. There are a total of `r nrow(combined_wheel)` observations. Each observation represents a specific dumpster, with key variables such as weight_tons, plastic_bottles, polystyrene, and cigarette_butts. The total weight of trash collected by Professor Trash Wheel is `r sum(subset(combined_wheel, source == "Professor Trash Wheel")$weight_tons, na.rm = TRUE)` tons. The total number of cigarette butts collected by Gwynnda Trash Wheel in June 2022 is `r sum(subset(combined_wheel, source == "Gwynnda Trash Wheel" & format(date, "%Y-%m") == "2022-06")$cigarette_butts, na.rm = TRUE)`.

#Problem 3

```{r}
#import the dataset
bakers <- read_csv("data/bakers.csv")
bakes <- read_csv("data/bakes.csv")
results <- read_csv("data/results.csv")

#look through dataset
head(bakers)
head(bakes)
head(results)
```
```{r}
#make results dataset more readable and reasonable
results <- results %>%
  rename(series = 1, episode = 2, baker = 3, technical = 4, result = 5) %>% 
  slice(-1) %>%
  filter(!is.na(series))
head(results)
```

```{r}
#convert the series to character
bakers <- bakers %>%
  mutate(Series = as.character(Series))

bakes <- bakes %>%
  mutate(Series = as.character(Series))

results <- results %>%
  mutate(series = as.character(series))


#check if there are any bakers in bakes who are not in bakers
unmatched1 <- bakes %>%
  anti_join(bakers, by = c("Baker" = "Baker Name", "Series" = "Series"))

#check if there are any bakers in results who are not in bakers
unmatched2 <- results %>%
  anti_join(bakers, by = c("baker" = "Baker Name", "series" = "Series"))

#look at unmatched rows if they have
head(unmatched1)
head(unmatched2)

```



